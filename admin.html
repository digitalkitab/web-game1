<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - WEB GAME</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#0a0e27;
  color:#fff;
  padding:20px;
}
.header{
  padding:20px;
  border:2px solid cyan;
  border-radius:10px;
  margin-bottom:20px;
}
h1{ color:cyan; }
.card{
  border:2px solid cyan;
  padding:15px;
  margin-bottom:15px;
  border-radius:10px;
}
.btn{
  padding:8px 15px;
  border:none;
  cursor:pointer;
  margin-right:10px;
}
.approve{ background:#00ff88; }
.reject{ background:#ff0055; color:#fff; }
</style>
</head>

<body>

<div class="header">
  <h1>WEB GAME ADMIN</h1>
  <p>User Management Dashboard</p>
</div>

<h2>Pending Users: <span id="totalPending">0</span></h2>

<div id="usersList"></div>

<script>
const API_BASE_URL = "https://web-game-backend-18mn.onrender.com";

const usersList = document.getElementById("usersList");
const totalPending = document.getElementById("totalPending");

loadPendingUsers();

async function loadPendingUsers(){
  try{
    const res = await fetch(`${API_BASE_URL}/admin/pending-users`);
    const users = await res.json();

    totalPending.innerText = users.length;

    if(users.length === 0){
      usersList.innerHTML = "<p>No pending users</p>";
      return;
    }

    usersList.innerHTML = "";

    users.forEach(user=>{
      const div = document.createElement("div");
      div.className="card";
      div.id = user._id;

      div.innerHTML = `
        <p><b>Username:</b> ${user.username}</p>
        <p><b>Email:</b> ${user.email || "N/A"}</p>
        <p><b>Phone:</b> ${user.phone || "N/A"}</p>
        <button class="btn approve" onclick="approveUser('${user._id}')">Approve</button>
        <button class="btn reject" onclick="rejectUser('${user._id}')">Reject</button>
      `;

      usersList.appendChild(div);
    });

  }catch(err){
    alert("Error loading users");
  }
}

async function approveUser(id){
  await fetch(`${API_BASE_URL}/admin/approve-user`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ userId:id })
  });
  document.getElementById(id).remove();
  updateCount();
}

async function rejectUser(id){
  if(!confirm("Reject this user?")) return;

  await fetch(`${API_BASE_URL}/admin/reject-user`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ userId:id })
  });
  document.getElementById(id).remove();
  updateCount();
}

function updateCount(){
  totalPending.innerText = document.querySelectorAll(".card").length;
}
</script>

</body>
</html>
