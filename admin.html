<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - WEB GAME</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #0a0e27;
  min-height: 100vh;
  padding: 20px;
  color: #fff;
}

body::before {
  content: '';
  position: fixed;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
  background-size: 50px 50px;
  animation: gridMove 20s linear infinite;
  z-index: -1;
}

@keyframes gridMove {
  0% { transform: translate(0, 0); }
  100% { transform: translate(50px, 50px); }
}

.container {
  max-width: 1200px;
  margin: 0 auto;
}

.header {
  background: rgba(10, 14, 39, 0.95);
  border: 2px solid rgba(0, 255, 255, 0.5);
  border-radius: 15px;
  padding: 30px;
  margin-bottom: 30px;
  box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
}

.logo-title {
  font-size: 32px;
  font-weight: bold;
  background: linear-gradient(45deg, #00ffff, #00ccff, #00ffff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-transform: uppercase;
  letter-spacing: 3px;
  text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
  margin-bottom: 10px;
}

.page-subtitle {
  color: rgba(255, 255, 255, 0.7);
  font-size: 16px;
}

.stats {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  flex: 1;
  background: rgba(10, 14, 39, 0.95);
  border: 2px solid rgba(0, 255, 255, 0.5);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

.stat-number {
  font-size: 36px;
  font-weight: bold;
  color: #00ffff;
  text-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
}

.stat-label {
  color: rgba(255, 255, 255, 0.7);
  margin-top: 5px;
}

.requests-list {
  background: rgba(10, 14, 39, 0.95);
  border: 2px solid rgba(0, 255, 255, 0.5);
  border-radius: 15px;
  padding: 30px;
  box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
}

.requests-list h2 {
  color: #00ffff;
  margin-bottom: 20px;
  text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
}

.request-card {
  background: rgba(0, 255, 255, 0.05);
  border: 2px solid rgba(0, 255, 255, 0.3);
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 15px;
  transition: all 0.3s ease;
}

.request-card:hover {
  border-color: #00ffff;
  background: rgba(0, 255, 255, 0.1);
}

.request-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.request-type {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.request-type.signup {
  background: rgba(0, 255, 136, 0.2);
  color: #00ff88;
  border: 1px solid rgba(0, 255, 136, 0.5);
}

.request-type.forgot-password {
  background: rgba(255, 165, 0, 0.2);
  color: #ffa500;
  border: 1px solid rgba(255, 165, 0, 0.5);
}

.request-info {
  margin-bottom: 15px;
}

.request-name {
  font-size: 18px;
  font-weight: bold;
  color: #00ffff;
  margin-bottom: 8px;
}

.request-details {
  color: rgba(255, 255, 255, 0.7);
  font-size: 14px;
  margin-bottom: 4px;
}

.request-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.btn-approve {
  padding: 10px 20px;
  background: linear-gradient(45deg, #00ff88, #00cc66);
  border: none;
  border-radius: 8px;
  color: #0a0e27;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
}

.btn-approve:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 25px rgba(0, 255, 136, 0.8);
}

.btn-reject {
  padding: 10px 20px;
  background: linear-gradient(45deg, #ff0055, #cc0044);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 15px rgba(255, 0, 85, 0.5);
}

.btn-reject:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 25px rgba(255, 0, 85, 0.8);
}

.btn-approve:disabled,
.btn-reject:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.password-input-group {
  display: none;
  margin-top: 10px;
  gap: 10px;
}

.password-input-group.show {
  display: flex;
}

.password-input {
  flex: 1;
  padding: 10px;
  background: rgba(0, 255, 255, 0.05);
  border: 2px solid rgba(0, 255, 255, 0.3);
  border-radius: 8px;
  color: #fff;
  font-size: 14px;
  outline: none;
}

.password-input:focus {
  border-color: #00ffff;
  background: rgba(0, 255, 255, 0.1);
}

.btn-reset-password {
  padding: 10px 20px;
  background: linear-gradient(45deg, #ffa500, #ff8800);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 15px rgba(255, 165, 0, 0.5);
}

.btn-reset-password:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 25px rgba(255, 165, 0, 0.8);
}

.empty-state {
  text-align: center;
  padding: 40px;
  color: rgba(255, 255, 255, 0.5);
  font-size: 18px;
}

@media (max-width: 768px) {
  .stats {
    flex-direction: column;
  }
  
  .request-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .request-actions {
    width: 100%;
  }
  
  .btn-approve,
  .btn-reject {
    flex: 1;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="logo-title">WEB GAME ADMIN</div>
    <div class="page-subtitle">Unified Request Management Dashboard</div>
  </div>

  <div class="stats">
    <div class="stat-card">
      <div class="stat-number" id="totalPending">0</div>
      <div class="stat-label">Total Pending Requests</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="signupCount">0</div>
      <div class="stat-label">Signup Requests</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="passwordCount">0</div>
      <div class="stat-label">Password Reset Requests</div>
    </div>
  </div>

  <div class="requests-list">
    <h2>Pending Requests</h2>
    <div id="requestsList"></div>
  </div>
</div>

<script>
const API_BASE_URL = 'https://web-game-backend-18mn.onrender.com';
const adminToken = 'your-secure-admin-secret-key-change-in-production';

const requestsList = document.getElementById('requestsList');
const totalPending = document.getElementById('totalPending');
const signupCount = document.getElementById('signupCount');
const passwordCount = document.getElementById('passwordCount');

loadPendingRequests();

async function loadPendingRequests() {
  try {
    const response = await fetch(`${API_BASE_URL}/api/admin/pending-requests`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    });

    if (!response.ok) {
      throw new Error('Failed to fetch requests');
    }

    const data = await response.json();
    displayRequests(data.requests);
  } catch (error) {
    console.error('Error loading requests:', error);
    requestsList.innerHTML = '<div class="empty-state">Failed to load requests</div>';
  }
}

function displayRequests(requests) {
  const signups = requests.filter(r => r.type === 'signup').length;
  const passwords = requests.filter(r => r.type === 'forgot_password').length;
  
  totalPending.textContent = requests.length;
  signupCount.textContent = signups;
  passwordCount.textContent = passwords;

  if (requests.length === 0) {
    requestsList.innerHTML = '<div class="empty-state">No pending requests</div>';
    return;
  }

  requestsList.innerHTML = requests.map(request => {
    const typeLabel = request.type === 'signup' ? 'Signup' : 'Password Reset';
    const typeClass = request.type === 'signup' ? 'signup' : 'forgot-password';
    
    let actionsHTML = '';
    if (request.type === 'signup') {
      actionsHTML = `
        <button class="btn-approve" onclick="approveSignup('${request._id}')">Approve Account</button>
        <button class="btn-reject" onclick="rejectSignup('${request._id}')">Reject Account</button>
      `;
    } else {
      actionsHTML = `
        <button class="btn-approve" onclick="showPasswordReset('${request._id}')">Reset Password</button>
        <button class="btn-reject" onclick="rejectPasswordReset('${request._id}')">Reject Request</button>
        <div class="password-input-group" id="password-group-${request._id}">
          <input type="password" class="password-input" id="new-password-${request._id}" placeholder="New Password (min 6 chars)">
          <button class="btn-reset-password" onclick="confirmPasswordReset('${request._id}')">Confirm Reset</button>
        </div>
      `;
    }

    return `
      <div class="request-card" id="request-${request._id}">
        <div class="request-header">
          <span class="request-type ${typeClass}">${typeLabel}</span>
          <span class="request-details">ðŸ•’ ${new Date(request.createdAt).toLocaleString()}</span>
        </div>
        <div class="request-info">
          <div class="request-name">ðŸ‘¤ ${escapeHtml(request.username)}</div>
          ${request.email ? `<div class="request-details">ðŸ“§ ${escapeHtml(request.email)}</div>` : ''}
          ${request.phone ? `<div class="request-details">ðŸ“± ${escapeHtml(request.phone)}</div>` : ''}
        </div>
        <div class="request-actions">
          ${actionsHTML}
        </div>
      </div>
    `;
  }).join('');
}

function showPasswordReset(requestId) {
  const passwordGroup = document.getElementById(`password-group-${requestId}`);
  passwordGroup.classList.toggle('show');
}

async function approveSignup(requestId) {
  const requestCard = document.getElementById(`request-${requestId}`);
  const buttons = requestCard.querySelectorAll('button');
  buttons.forEach(btn => btn.disabled = true);

  try {
    const response = await fetch(`${API_BASE_URL}/api/admin/approve-signup`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${adminToken}`
      },
      body: JSON.stringify({ requestId })
    });

    const data = await response.json();

    if (response.ok && data.success) {
      removeRequestCard(requestCard);
    } else {
      throw new Error(data.message);
    }
  } catch (error) {
    alert('Failed to approve signup: ' + error.message);
    buttons.forEach(btn => btn.disabled = false);
  }
}

async function rejectSignup(requestId) {
  if (!confirm('Are you sure you want to reject this signup? This will delete the user account permanently.')) {
    return;
  }

  const requestCard = document.getElementById(`request-${requestId}`);
  const buttons = requestCard.querySelectorAll('button');
  buttons.forEach(btn => btn.disabled = true);

  try {
    const response = await fetch(`${API_BASE_URL}/api/admin/reject-signup`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${adminToken}`
      },
      body: JSON.stringify({ requestId })
    });

    const data = await response.json();

    if (response.ok && data.success) {
      removeRequestCard(requestCard);
    } else {
      throw new Error(data.message);
    }
  } catch (error) {
    alert('Failed to reject signup: ' + error.message);
    buttons.forEach(btn => btn.disabled = false);
  }
}

async function confirmPasswordReset(requestId) {
  const newPassword = document.getElementById(`new-password-${requestId}`).value.trim();
  
  if (!newPassword) {
    alert('Please enter a new password');
    return;
  }
  
  if (newPassword.length < 6) {
    alert('Password must be at least 6 characters');
    return;
  }

  const requestCard = document.getElementById(`request-${requestId}`);
  const buttons = requestCard.querySelectorAll('button');
  buttons.forEach(btn => btn.disabled = true);

  try {
    const response = await fetch(`${API_BASE_URL}/api/admin/reset-password`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${adminToken}`
      },
      body: JSON.stringify({ requestId, newPassword })
    });

    const data = await response.json();

    if (response.ok && data.success) {
      removeRequestCard(requestCard);
    } else {
      throw new Error(data.message);
    }
  } catch (error) {
    alert('Failed to reset password: ' + error.message);
    buttons.forEach(btn => btn.disabled = false);
  }
}

async function rejectPasswordReset(requestId) {
  if (!confirm('Are you sure you want to reject this password reset request?')) {
    return;
  }

  const requestCard = document.getElementById(`request-${requestId}`);
  const buttons = requestCard.querySelectorAll('button');
  buttons.forEach(btn => btn.disabled = true);

  try {
    const response = await fetch(`${API_BASE_URL}/api/admin/reject-password-reset`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${adminToken}`
      },
      body: JSON.stringify({ requestId })
    });

    const data = await response.json();

    if (response.ok && data.success) {
      removeRequestCard(requestCard);
    } else {
      throw new Error(data.message);
    }
  } catch (error) {
    alert('Failed to reject password reset: ' + error.message);
    buttons.forEach(btn => btn.disabled = false);
  }
}

function removeRequestCard(card) {
  card.style.transition = 'all 0.5s ease';
  card.style.opacity = '0';
  card.style.transform = 'scale(0.8)';
  setTimeout(() => {
    card.remove();
    updateStats();
  }, 500);
}

function updateStats() {
  const remainingRequests = document.querySelectorAll('.request-card').length;
  const signups = document.querySelectorAll('.request-type.signup').length;
  const passwords = document.querySelectorAll('.request-type.forgot-password').length;
  
  totalPending.textContent = remainingRequests;
  signupCount.textContent = signups;
  passwordCount.textContent = passwords;
  
  if (remainingRequests === 0) {
    requestsList.innerHTML = '<div class="empty-state">No pending requests</div>';
  }
}

function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}

setInterval(() => {
  loadPendingRequests();
}, 30000);
</script>

</body>
</html>
