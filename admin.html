<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - WEB GAME</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ✅ UI SAME – untouched */
body{
  background:#0a0e27;
  color:#fff;
  font-family:Segoe UI, sans-serif;
  padding:20px
}
.card{
  background:#0f1435;
  border:1px solid #00ffff55;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px
}
.btn{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-right:6px
}
.approve{background:#00ff88}
.reject{background:#ff0055;color:#fff}
</style>
</head>
<body>

<h1>WEB GAME ADMIN</h1>
<h3>Forgot Password Requests</h3>

<div id="list"></div>

<script>
const API = "https://web-game-backend-18mn.onrender.com";
const ADMIN_SECRET = "PASTE_YOUR_ADMIN_SECRET_HERE";

const list = document.getElementById("list");

load();

async function load(){
  list.innerHTML="Loading...";
  const res = await fetch(API+"/admin/forgot-requests",{
    headers:{
      "x-admin-secret":ADMIN_SECRET
    }
  });
  const data = await res.json();

  if(!Array.isArray(data) || data.length===0){
    list.innerHTML="No pending requests";
    return;
  }

  list.innerHTML="";
  data.forEach(r=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <b>User:</b> ${r.username}<br>
      <b>Time:</b> ${r.time}<br><br>
      <input type="password" placeholder="New Password" id="p_${r._id}">
      <br><br>
      <button class="btn approve" onclick="reset('${r.username}','${r._id}')">Reset</button>
    `;
    list.appendChild(div);
  });
}

async function reset(username,id){
  const pwd=document.getElementById("p_"+id).value;
  if(pwd.length<6){
    alert("Min 6 chars");
    return;
  }

  await fetch(API+"/admin/reset-password",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "x-admin-secret":ADMIN_SECRET
    },
    body:JSON.stringify({
      username,
      newPassword:pwd
    })
  });

  alert("Password reset done");
  load();
}
</script>

</body>
</html>
