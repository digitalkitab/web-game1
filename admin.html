<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<style>
body{
  background:#020617;
  color:white;
  font-family:Arial;
  padding:20px;
}
h2{
  color:cyan;
}
.card{
  border:1px solid cyan;
  padding:10px;
  margin:10px 0;
}
input,button{
  margin-top:6px;
  padding:6px;
}
button{
  cursor:pointer;
}
</style>
</head>

<body>

<h2>Admin – Forgot Password Requests</h2>
<div id="list">Loading...</div>

<script>
const API = "https://web-game-backend-18mn.onrender.com";
const ADMIN_SECRET = "admin@ak47$pawan";

async function load(){
  try{
    const res = await fetch(API + "/admin/forgot-requests", {
      headers: {
        "x-admin-secret": ADMIN_SECRET
      }
    });

    if(!res.ok){
      document.getElementById("list").innerText =
        "❌ Unauthorized (admin secret wrong)";
      return;
    }

    const data = await res.json();
    const list = document.getElementById("list");
    list.innerHTML = "";

    if(data.length === 0){
      list.innerText = "No forgot-password requests yet.";
      return;
    }

    data.forEach(req => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <b>User:</b> ${req.username}<br>
        <b>Time:</b> ${req.time}<br><br>
        <input type="password" placeholder="New Password" id="p_${req.username}">
        <button onclick="resetPassword('${req.username}')">
          Reset Password
        </button>
      `;
      list.appendChild(div);
    });

  }catch(e){
    document.getElementById("list").innerText =
      "❌ Backend not reachable";
  }
}

async function resetPassword(username){
  const newPass =
    document.getElementById("p_" + username).value;

  if(!newPass){
    alert("Enter new password");
    return;
  }

  const res = await fetch(API + "/admin/reset-password", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-admin-secret": ADMIN_SECRET
    },
    body: JSON.stringify({
      username: username,
      newPassword: newPass
    })
  });

  const data = await res.json();
  alert(data.success ? "✅ Password reset successful"
                     : "❌ Reset failed");
}

load();
</script>

</body>
</html>
